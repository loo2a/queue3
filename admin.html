<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù†Ø¸Ø§Ù… Ù†Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø±Ø¶Ù‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/custom-styles.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen" dir="rtl">
    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-r from-blue-600 to-indigo-600 shadow-lg mb-6">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-bold text-white">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
                    <span class="bg-white text-blue-600 px-3 py-1 rounded-full text-sm font-semibold">Admin</span>
                </div>
                <div class="flex gap-3">
                    <a href="index.html" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50 transition font-semibold">
                        Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                    <a href="display.html" target="_blank" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition font-semibold">
                        Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶
                    </a>
                    <a href="control.html" target="_blank" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition font-semibold">
                        Ø§Ù„ØªØ­ÙƒÙ…
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 pb-8">
        <!-- Settings Section -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
            <div class="flex items-center gap-3 mb-6">
                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <h2 class="text-3xl font-bold text-gray-800">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²</h2>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block mb-2 font-semibold text-gray-700">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²</label>
                    <input type="text" id="centerName" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition" placeholder="Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ©">
                </div>
                
                <div>
                    <label class="block mb-2 font-semibold text-gray-700">Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ø·Ù‚</label>
                    <div class="flex items-center gap-4">
                        <input type="range" id="speechRate" min="0.5" max="2" step="0.1" value="1" class="flex-1">
                        <span id="speechRateValue" class="text-blue-600 font-bold text-lg w-16">1.0x</span>
                    </div>
                </div>
                
                <div>
                    <label class="block mb-2 font-semibold text-gray-700">Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØªÙŠØ§Øª</label>
                    <input type="text" id="audioPath" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition text-sm" placeholder="./audio/">
                </div>
                
                <div>
                    <label class="block mb-2 font-semibold text-gray-700">Ù…Ø³Ø§Ø± Ø§Ù„Ù…ÙŠØ¯ÙŠØ§</label>
                    <input type="text" id="mediaPath" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition text-sm" placeholder="./media/">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block mb-2 font-semibold text-gray-700">Ù†Øµ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</label>
                    <textarea id="newsText" rows="2" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition" placeholder="Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø±ÙƒØ²Ù†Ø§ Ø§Ù„Ø·Ø¨ÙŠ"></textarea>
                </div>
            </div>
            
            <button onclick="saveSettings()" class="mt-6 bg-gradient-to-r from-green-600 to-green-700 text-white px-8 py-3 rounded-lg hover:from-green-700 hover:to-green-800 transition font-bold text-lg shadow-lg">
                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
        </div>

        <!-- Clinics Management Section -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    <h2 class="text-3xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h2>
                </div>
                <button onclick="showAddClinicForm()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-blue-800 transition font-bold shadow-lg">
                    â• Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø©
                </button>
            </div>

            <!-- Add Clinic Form -->
            <div id="addClinicForm" class="hidden mb-6 p-6 bg-blue-50 rounded-lg border-2 border-blue-200">
                <h3 class="text-xl font-bold mb-4 text-blue-800">Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <input type="text" id="newClinicName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" class="p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    <input type="number" id="newClinicNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" class="p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    <input type="password" id="newClinicPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="p-3 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    <div class="flex gap-2">
                        <button onclick="addClinic()" class="flex-1 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition font-bold">
                            âœ“ Ø­ÙØ¸
                        </button>
                        <button onclick="hideAddClinicForm()" class="bg-gray-400 text-white px-4 py-3 rounded-lg hover:bg-gray-500 transition font-bold">
                            âœ—
                        </button>
                    </div>
                </div>
            </div>

            <!-- Clinics List -->
            <div id="clinicsList" class="space-y-4">
                <!-- Clinics will be inserted here -->
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="bg-white rounded-xl shadow-lg p-8">
            <div class="flex items-center gap-3 mb-6">
                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                <h2 class="text-3xl font-bold text-gray-800">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Call Ticket -->
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                    <h3 class="font-bold mb-4 text-xl">ğŸ”Š Ù†Ø¯Ø§Ø¡ Ø¹Ù…ÙŠÙ„</h3>
                    <select id="callClinicSelect" class="w-full p-2 rounded-lg mb-2 text-gray-800">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>
                    </select>
                    <input type="number" id="callTicketNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" class="w-full p-2 rounded-lg mb-2 text-gray-800">
                    <button onclick="callTicket()" class="w-full bg-white text-blue-600 p-2 rounded-lg hover:bg-blue-50 transition font-bold">
                        Ù†Ø¯Ø§Ø¡
                    </button>
                </div>

                <!-- Display Name -->
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
                    <h3 class="font-bold mb-4 text-xl">ğŸ‘¤ Ø¹Ø±Ø¶ Ø§Ø³Ù…</h3>
                    <input type="text" id="displayNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" class="w-full p-2 rounded-lg mb-2 text-gray-800">
                    <button onclick="displayName()" class="w-full bg-white text-green-600 p-2 rounded-lg hover:bg-green-50 transition font-bold mt-8">
                        Ø¹Ø±Ø¶
                    </button>
                </div>

                <!-- Record Audio -->
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
                    <h3 class="font-bold mb-4 text-xl">ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</h3>
                    <button onclick="startRecording()" id="recordBtn" class="w-full bg-white text-purple-600 p-2 rounded-lg hover:bg-purple-50 transition font-bold">
                        Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    </button>
                    <div id="recordingStatus" class="mt-2 text-center text-sm hidden">
                        ğŸ”´ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...
                    </div>
                </div>

                <!-- Instant Audio -->
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white shadow-lg">
                    <h3 class="font-bold mb-4 text-xl">ğŸ“¢ Ù…Ù„Ù Ø¬Ø§Ù‡Ø²</h3>
                    <select id="instantAudioSelect" class="w-full p-2 rounded-lg mb-2 text-gray-800">
                        <option value="">Ø§Ø®ØªØ± Ù…Ù„Ù</option>
                        <option value="announcement1.mp3">Ø¥Ø¹Ù„Ø§Ù† 1</option>
                        <option value="announcement2.mp3">Ø¥Ø¹Ù„Ø§Ù† 2</option>
                        <option value="emergency.mp3">Ø·ÙˆØ§Ø±Ø¦</option>
                        <option value="welcome.mp3">ØªØ±Ø­ÙŠØ¨</option>
                        <option value="closing.mp3">Ø¥ØºÙ„Ø§Ù‚</option>
                        <option value="prayer.mp3">ØµÙ„Ø§Ø©</option>
                    </select>
                    <button onclick="playInstantAudio()" class="w-full bg-white text-orange-600 p-2 rounded-lg hover:bg-orange-50 transition font-bold">
                        ØªØ´ØºÙŠÙ„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script src="js/audio-handler.js"></script>
    <script src="js/queue-manager.js"></script>
    <script>
        // Initialize
        let settings = {
            centerName: 'Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ©',
            speechRate: 1.0,
            audioPath: './audio/',
            mediaPath: './media/',
            newsText: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø±ÙƒØ²Ù†Ø§ Ø§Ù„Ø·Ø¨ÙŠ - Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø§Ù„Ø´ÙØ§Ø¡ Ø§Ù„Ø¹Ø§Ø¬Ù„'
        };

        let clinics = [];
        let isRecording = false;

        // Load data on page load
        window.addEventListener('load', async () => {
            await loadSettings();
            await loadClinics();
            renderClinics();
            populateClinicSelects();
        });

        // Wait for Firebase to load
        function waitForFirebase() {
            return new Promise((resolve) => {
                if (window.storage) {
                    resolve();
                } else {
                    setTimeout(() => waitForFirebase().then(resolve), 100);
                }
            });
        }

        // Load settings from storage
        async function loadSettings() {
            await waitForFirebase();
            try {
                const result = await window.storage.get('clinic-settings');
                if (result && result.value) {
                    settings = typeof result.value === 'string' ? JSON.parse(result.value) : result.value;
                    
                    // Update UI
                    document.getElementById('centerName').value = settings.centerName;
                    document.getElementById('speechRate').value = settings.speechRate;
                    document.getElementById('speechRateValue').textContent = settings.speechRate + 'x';
                    document.getElementById('audioPath').value = settings.audioPath;
                    document.getElementById('mediaPath').value = settings.mediaPath;
                    document.getElementById('newsText').value = settings.newsText;
                }
            } catch (error) {
                console.log('No saved settings found, using defaults');
            }
        }

        // Save settings to storage
        async function saveSettings() {
            settings = {
                centerName: document.getElementById('centerName').value,
                speechRate: parseFloat(document.getElementById('speechRate').value),
                audioPath: document.getElementById('audioPath').value,
                mediaPath: document.getElementById('mediaPath').value,
                newsText: document.getElementById('newsText').value
            };

            try {
                await window.storage.set('clinic-settings', settings);
                
                // Show success message
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!';
                btn.classList.add('bg-green-600');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-600');
                }, 2000);
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
                console.error(error);
            }
        }

        // Update speech rate display
        document.getElementById('speechRate').addEventListener('input', (e) => {
            document.getElementById('speechRateValue').textContent = e.target.value + 'x';
        });

        // Load clinics from storage
        async function loadClinics() {
            await waitForFirebase();
            try {
                const result = await window.storage.get('clinic-list');
                if (result && result.value) {
                    clinics = typeof result.value === 'string' ? JSON.parse(result.value) : result.value;
                } else {
                    // Default clinics if none exist
                    clinics = [
                        { id: Date.now() + 1, name: 'Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©', number: 1, password: '1234', currentTicket: 0, isActive: true, lastCall: null },
                        { id: Date.now() + 2, name: 'Ø§Ù„Ø£Ø³Ù†Ø§Ù†', number: 2, password: '1234', currentTicket: 0, isActive: true, lastCall: null },
                        { id: Date.now() + 3, name: 'Ø§Ù„Ø¬Ù„Ø¯ÙŠØ©', number: 3, password: '1234', currentTicket: 0, isActive: true, lastCall: null }
                    ];
                    await saveClinics();
                }
            } catch (error) {
                console.log('No saved clinics found, using defaults');
            }
        }

        // Save clinics to storage
        async function saveClinics() {
            try {
                await window.storage.set('clinic-list', JSON.stringify(clinics));
            } catch (error) {
                console.error('Error saving clinics:', error);
            }
        }

        // Render clinics list
        function renderClinics() {
            const container = document.getElementById('clinicsList');
            container.innerHTML = '';

            if (clinics.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠØ§Ø¯Ø§Øª. Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø©" Ù„Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©.</p>';
                return;
            }

            clinics.forEach(clinic => {
                const card = document.createElement('div');
                card.className = 'border-2 border-gray-200 rounded-lg p-6 hover:border-blue-400 transition bg-gradient-to-r from-white to-gray-50';
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">${clinic.name}</h3>
                            <div class="flex gap-6 text-sm text-gray-600">
                                <span><strong>Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:</strong> ${clinic.number}</span>
                                <span><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span class="text-blue-600 font-bold text-lg">${clinic.currentTicket}</span></span>
                                <span class="px-3 py-1 rounded-full ${clinic.isActive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                    ${clinic.isActive ? 'ğŸŸ¢ Ù†Ø´Ø·' : 'ğŸ”´ Ù…ØªÙˆÙ‚Ù'}
                                </span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editClinic(${clinic.id})" class="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition" title="ØªØ¹Ø¯ÙŠÙ„">
                                âœï¸
                            </button>
                            <button onclick="toggleClinicStatus(${clinic.id})" class="bg-yellow-600 text-white p-3 rounded-lg hover:bg-yellow-700 transition" title="${clinic.isActive ? 'Ø¥ÙŠÙ‚Ø§Ù' : 'ØªÙØ¹ÙŠÙ„'}">
                                ${clinic.isActive ? 'â¸ï¸' : 'â–¶ï¸'}
                            </button>
                            <button onclick="deleteClinic(${clinic.id})" class="bg-red-600 text-white p-3 rounded-lg hover:bg-red-700 transition" title="Ø­Ø°Ù">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Show add clinic form
        function showAddClinicForm() {
            document.getElementById('addClinicForm').classList.remove('hidden');
            document.getElementById('newClinicName').focus();
        }

        // Hide add clinic form
        function hideAddClinicForm() {
            document.getElementById('addClinicForm').classList.add('hidden');
            document.getElementById('newClinicName').value = '';
            document.getElementById('newClinicNumber').value = '';
            document.getElementById('newClinicPassword').value = '';
        }

        // Add clinic
        async function addClinic() {
            const name = document.getElementById('newClinicName').value.trim();
            const number = parseInt(document.getElementById('newClinicNumber').value);
            const password = document.getElementById('newClinicPassword').value;

            if (!name || !number || !password) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const newClinic = {
                id: Date.now(),
                name,
                number,
                password,
                currentTicket: 0,
                isActive: true,
                lastCall: null
            };

            clinics.push(newClinic);
            await saveClinics();
            renderClinics();
            populateClinicSelects();
            hideAddClinicForm();
        }

        // Edit clinic (simplified - show prompt)
        async function editClinic(id) {
            const clinic = clinics.find(c => c.id === id);
            if (!clinic) return;

            const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:', clinic.name);
            if (!newName) return;

            const newNumber = prompt('Ø±Ù‚Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:', clinic.number);
            if (!newNumber) return;

            const newPassword = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', clinic.password);
            if (!newPassword) return;

            clinic.name = newName;
            clinic.number = parseInt(newNumber);
            clinic.password = newPassword;

            await saveClinics();
            renderClinics();
            populateClinicSelects();
        }

        // Toggle clinic status
        async function toggleClinicStatus(id) {
            const clinic = clinics.find(c => c.id === id);
            if (!clinic) return;

            clinic.isActive = !clinic.isActive;
            await saveClinics();
            renderClinics();
        }

        // Delete clinic
        async function deleteClinic(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©ØŸ')) return;

            clinics = clinics.filter(c => c.id !== id);
            await saveClinics();
            renderClinics();
            populateClinicSelects();
        }

        // Populate clinic selects
        function populateClinicSelects() {
            const select = document.getElementById('callClinicSelect');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©</option>';
            
            clinics.forEach(clinic => {
                const option = document.createElement('option');
                option.value = clinic.id;
                option.textContent = clinic.name;
                select.appendChild(option);
            });
        }

        // Call ticket
        async function callTicket() {
            const clinicId = parseInt(document.getElementById('callClinicSelect').value);
            const ticketNumber = parseInt(document.getElementById('callTicketNumber').value);

            if (!clinicId || !ticketNumber) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ÙˆØ±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„');
                return;
            }

            const clinic = clinics.find(c => c.id === clinicId);
            if (!clinic) return;

            const callData = {
                clinicId: clinic.id,
                ticketNumber: ticketNumber,
                clinicName: clinic.name,
                clinicNumber: clinic.number,
                timestamp: Date.now()
            };

            try {
                await window.storage.set('current-call', JSON.stringify(callData), true);
                
                // Update clinic current ticket
                clinic.currentTicket = ticketNumber;
                clinic.lastCall = new Date().toISOString();
                await saveClinics();
                renderClinics();

                // Show success
                alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
                document.getElementById('callTicketNumber').value = '';
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø¯Ø§Ø¡');
                console.error(error);
            }
        }

        // Display name
        async function displayName() {
            const name = document.getElementById('displayNameInput').value.trim();
            
            if (!name) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…');
                return;
            }

            try {
                await window.storage.set('display-name', name, true);
                alert('ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©');
                document.getElementById('displayNameInput').value = '';
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù…');
                console.error(error);
            }
        }

        // Start recording
        function startRecording() {
            const btn = document.getElementById('recordBtn');
            const status = document.getElementById('recordingStatus');
            
            if (!isRecording) {
                isRecording = true;
                btn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„';
                btn.classList.add('bg-red-500');
                status.classList.remove('hidden');
                
                // Simulate recording (ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø³ØªØ­ØªØ§Ø¬ MediaRecorder API)
                setTimeout(() => {
                    stopRecording();
                }, 5000);
            } else {
                stopRecording();
            }
        }

        function stopRecording() {
            isRecording = false;
            const btn = document.getElementById('recordBtn');
            const status = document.getElementById('recordingStatus');
            
            btn.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„';
            btn.classList.remove('bg-red-500');
            status.classList.add('hidden');
            
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ù…Ø­Ø§ÙƒØ§Ø©)');
        }

        // Play instant audio
        async function playInstantAudio() {
            const filename = document.getElementById('instantAudioSelect').value;
            
            if (!filename) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØªÙŠ');
                return;
            }

            try {
                await window.storage.set('instant-audio', filename, true);
                alert('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ');
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
                console.error(error);
            }
        }
    </script>
</body>
</html>
