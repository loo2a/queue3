<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-900 to-purple-900 min-h-screen text-white p-8" dir="rtl">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white text-gray-800 rounded-2xl shadow-2xl p-8 mb-6">
            <h1 class="text-4xl font-bold mb-6 text-center text-blue-800">ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø± Firebase</h1>
            
            <div id="status" class="mb-6 p-4 rounded-lg text-center font-bold text-lg">
                Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
            </div>

            <div class="space-y-4">
                <!-- Test 1: Write Data -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-lg">1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©</h3>
                    <button onclick="testWrite()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">
                        ÙƒØªØ§Ø¨Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    <div id="writeResult" class="mt-2 text-sm"></div>
                </div>

                <!-- Test 2: Read Data -->
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-lg">2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</h3>
                    <button onclick="testRead()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full">
                        Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                    <div id="readResult" class="mt-2 text-sm"></div>
                </div>

                <!-- Test 3: Test Settings -->
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-lg">3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                    <button onclick="testSettings()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 w-full">
                        Ø­ÙØ¸ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                    <div id="settingsResult" class="mt-2 text-sm"></div>
                </div>

                <!-- Test 4: Test Clinics -->
                <div class="bg-orange-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-lg">4ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h3>
                    <button onclick="testClinics()" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 w-full">
                        Ø­ÙØ¸ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª
                    </button>
                    <div id="clinicsResult" class="mt-2 text-sm"></div>
                </div>

                <!-- Test 5: Test Call -->
                <div class="bg-red-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-lg">5ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¯Ø§Ø¡</h3>
                    <button onclick="testCall()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 w-full">
                        Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¯Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    <div id="callResult" class="mt-2 text-sm"></div>
                </div>

                <!-- Firebase Data Viewer -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2 text-lg">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <button onclick="viewAllData()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 w-full mb-2">
                        Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                    <pre id="dataViewer" class="bg-gray-800 text-green-400 p-4 rounded text-xs overflow-auto max-h-96"></pre>
                </div>
            </div>
        </div>

        <div class="text-center">
            <a href="index.html" class="text-blue-200 hover:text-white underline">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script>
        // Wait for Firebase to load
        async function waitForFirebase() {
            return new Promise((resolve) => {
                const check = () => {
                    if (window.storage) {
                        resolve();
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }

        // Initialize
        async function init() {
            await waitForFirebase();
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = 'âœ… Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!';
            statusDiv.className = 'mb-6 p-4 rounded-lg text-center font-bold text-lg bg-green-100 text-green-800';
            
            console.log('âœ… Firebase Storage Ready');
            console.log('ğŸ”— Database URL:', window.firebaseConfig.databaseURL);
        }

        // Test 1: Write
        async function testWrite() {
            const resultDiv = document.getElementById('writeResult');
            try {
                const testData = {
                    message: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ù† Ø§Ø®ØªØ¨Ø§Ø± Firebase',
                    timestamp: Date.now()
                };
                
                await window.storage.set('test', testData);
                resultDiv.innerHTML = '<span class="text-green-600">âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­</span>';
                console.log('âœ… Write test passed');
            } catch (error) {
                resultDiv.innerHTML = '<span class="text-red-600">âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + error.message + '</span>';
                console.error('âŒ Write test failed:', error);
            }
        }

        // Test 2: Read
        async function testRead() {
            const resultDiv = document.getElementById('readResult');
            try {
                const result = await window.storage.get('test');
                if (result && result.value) {
                    resultDiv.innerHTML = '<span class="text-green-600">âœ… ØªÙ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ù†Ø¬Ø§Ø­: ' + JSON.stringify(result.value) + '</span>';
                    console.log('âœ… Read test passed:', result.value);
                } else {
                    resultDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª. Ø¬Ø±Ø¨ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹</span>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<span class="text-red-600">âŒ ÙØ´Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ' + error.message + '</span>';
                console.error('âŒ Read test failed:', error);
            }
        }

        // Test 3: Settings
        async function testSettings() {
            const resultDiv = document.getElementById('settingsResult');
            try {
                const settings = {
                    centerName: 'Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© - Ø§Ø®ØªØ¨Ø§Ø±',
                    speechRate: 1.0,
                    audioPath: './audio/',
                    newsText: 'Ù†Øµ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø£Ø®Ø¨Ø§Ø±'
                };
                
                await window.storage.set('clinic-settings', settings);
                resultDiv.innerHTML = '<span class="text-blue-600">ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...</span>';
                
                setTimeout(async () => {
                    const result = await window.storage.get('clinic-settings');
                    if (result && result.value) {
                        resultDiv.innerHTML = '<span class="text-green-600">âœ… Ù†Ø¬Ø­! Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + JSON.stringify(result.value).substring(0, 100) + '...</span>';
                        console.log('âœ… Settings test passed:', result.value);
                    }
                }, 1000);
            } catch (error) {
                resultDiv.innerHTML = '<span class="text-red-600">âŒ Ø®Ø·Ø£: ' + error.message + '</span>';
                console.error('âŒ Settings test failed:', error);
            }
        }

        // Test 4: Clinics
        async function testClinics() {
            const resultDiv = document.getElementById('clinicsResult');
            try {
                const clinics = [
                    { id: 1, name: 'Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©', number: 1, password: '1234', currentTicket: 0, isActive: true },
                    { id: 2, name: 'Ø§Ù„Ø£Ø³Ù†Ø§Ù†', number: 2, password: '1234', currentTicket: 0, isActive: true }
                ];
                
                await window.storage.set('clinic-list', clinics);
                resultDiv.innerHTML = '<span class="text-blue-600">ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...</span>';
                
                setTimeout(async () => {
                    const result = await window.storage.get('clinic-list');
                    if (result && result.value) {
                        const data = Array.isArray(result.value) ? result.value : [result.value];
                        resultDiv.innerHTML = '<span class="text-green-600">âœ… Ù†Ø¬Ø­! Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª: ' + data.length + '</span>';
                        console.log('âœ… Clinics test passed:', data);
                    }
                }, 1000);
            } catch (error) {
                resultDiv.innerHTML = '<span class="text-red-600">âŒ Ø®Ø·Ø£: ' + error.message + '</span>';
                console.error('âŒ Clinics test failed:', error);
            }
        }

        // Test 5: Call
        async function testCall() {
            const resultDiv = document.getElementById('callResult');
            try {
                const callData = {
                    clinicId: 1,
                    ticketNumber: 123,
                    clinicName: 'Ø·Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©',
                    clinicNumber: 1,
                    timestamp: Date.now()
                };
                
                await window.storage.set('current-call', callData, true);
                resultDiv.innerHTML = '<span class="text-green-600">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!</span>';
                console.log('âœ… Call test passed:', callData);
            } catch (error) {
                resultDiv.innerHTML = '<span class="text-red-600">âŒ Ø®Ø·Ø£: ' + error.message + '</span>';
                console.error('âŒ Call test failed:', error);
            }
        }

        // View all data
        async function viewAllData() {
            const viewer = document.getElementById('dataViewer');
            viewer.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            
            try {
                const paths = ['clinic-settings', 'clinic-list', 'current-call', 'test'];
                const allData = {};
                
                for (const path of paths) {
                    try {
                        const result = await window.storage.get(path);
                        allData[path] = result ? result.value : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
                    } catch (error) {
                        allData[path] = 'Ø®Ø·Ø£: ' + error.message;
                    }
                }
                
                viewer.textContent = JSON.stringify(allData, null, 2);
                console.log('ğŸ“Š All data:', allData);
            } catch (error) {
                viewer.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message;
                console.error('âŒ View data failed:', error);
            }
        }

        // Run on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
